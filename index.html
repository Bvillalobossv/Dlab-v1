<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SenseWell</title>

  <!-- Styles -->
  <link rel="stylesheet" href="styles.css" />

  <!-- Librer√≠as externas -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/dist/face-api.min.js"></script>
  
  <!-- El script de VitalLens se cargar√° din√°micamente -->

  <!-- PWA ready (opcional) -->
  <meta name="theme-color" content="#0b1020"/>
</head>
<body>
  
  <!-- ====================== ONBOARDING (CARRUSEL) ====================== -->
  <div id="screenIntro" class="screen active">
    <div class="carousel-shell max-900">
      <div class="slides" id="introSlides">
        <section class="slide">
          <div class="slide-media"><img src="images/mockup.png" alt="SenseWell" /></div>
          <div class="slide-text"><h2>Bienvenido a SenseWell</h2><p>Una app para <b>cuidar tu energ√≠a</b> en el trabajo. Tres pasos simples: <b>selfie emocional</b>, <b>ruido ambiental</b> y <b>body scan</b>.</p></div>
        </section>
        <section class="slide">
          <div class="slide-media gradient-card"><img src="images/logo.png" alt="Privacidad" class="logo-big" style="opacity: 0.5;"/><h3>Tu Bienestar, Tu Control</h3><ul><li><b style="color: white;">Medimos, no escuchamos:</b> Solo analizamos los decibeles (dB) del ambiente. Tus conversaciones son y ser√°n siempre privadas.</li><li><b style="color: white;">An√°lisis en tu dispositivo:</b> Tu rostro se procesa localmente. Tu imagen nunca sale de tu tel√©fono.</li><li><b style="color: white;">Datos an√≥nimos:</b> La informaci√≥n que guardas es para ti. Revisa m√°s en nuestra pol√≠tica de privacidad.</li></ul></div>
          <div class="slide-text"><h2>La Privacidad es la base de la Confianza</h2><p>Para darte las mejores recomendaciones, SenseWell necesita acceso a tu c√°mara y micr√≥fono. Te garantizamos que tu privacidad es nuestra m√°xima prioridad.</p></div>
        </section>
        <section class="slide">
          <div class="slide-media"><img src="images/mockup.png" alt="An√°lisis SenseWell" /></div>
          <div class="slide-text"><h2>Tu Term√≥metro de Bienestar</h2><p>En solo segundos, obtendr√°s un indicador que combina tu estado emocional, el ambiente que te rodea y tus sensaciones f√≠sicas. Est√°s a un paso de comenzar un d√≠a m√°s consciente y equilibrado.</p></div>
        </section>
      </div>
      <div class="dots" id="introDots"></div>
      <div class="stack-sm"><button id="introPrev" class="btn btn-secondary">Anterior</button><button id="introNext" class="btn">Siguiente</button><button id="introStart" class="btn btn-outline" style="display:none">¬°Comenzar!</button></div>
    </div>
  </div>

  <!-- ====================== AUTH (LOGIN/REGISTRO) ====================== -->
  <div id="screenAuth" class="screen">
    <img src="images/logo.png" alt="SenseWell" class="logo" />
    <h1>SenseWell</h1>
    <p class="lead">Tu compa√±ero diario para <b>cuidar tu energ√≠a</b>.</p>
    <div class="card max-600">
      <div class="segmented"><button id="authTabLogin" class="segment active">Iniciar sesi√≥n</button><button id="authTabSignup" class="segment">Crear cuenta</button></div>
      <form id="formLogin" class="form"><div class="form-row"><label>Usuario</label><input type="text" id="login_user" autocomplete="username" required /></div><div class="form-row"><label>Contrase√±a</label><input type="password" id="login_pass" autocomplete="current-password" required /></div><button type="submit" class="btn">Entrar</button></form>
      <form id="formSignup" class="form" style="display:none"><div class="form-row"><label>Usuario</label><input type="text" id="su_user" autocomplete="username" required /></div><div class="form-row"><label>Contrase√±a (m√≠nimo 6 caracteres)</label><input type="password" id="su_pass" autocomplete="new-password" minlength="6" required /></div><div class="form-row chk"><label><input type="checkbox" id="su_terms" required /> Acepto t√©rminos y condiciones</label></div><button type="submit" class="btn">Crear cuenta</button></form>
      <p id="auth-message" class="muted small">Crea una cuenta o inicia sesi√≥n para continuar.</p>
      <button id="goAbout" class="btn btn-outline">Sobre la app</button>
    </div>
  </div>

  <!-- ====================== SOBRE LA APP ====================== -->
  <div id="screenAbout" class="screen">
    <div class="card max-700">
      <h2 id="welcome-user">Sobre SenseWell</h2>
      <p>Esta aplicaci√≥n est√° pensada como un <b>espacio integral de bienestar</b>, con herramientas de detecci√≥n temprana, prevenci√≥n y apoyo para tu autocuidado.</p>
      <ul>
        <li><b>Selfie emocional</b>: detecci√≥n de emoci√≥n dominante en el rostro.</li>
        <li><b>Signos Vitales</b>: Estimaci√≥n de frecuencia card√≠aca y respiratoria.</li>
        <li><b>Ruido ambiental</b>: estimaci√≥n de dB(A) en 5s.</li>
        <li><b>Body Scan</b>: tensi√≥n en 3 zonas con resumen y gr√°fico.</li>
      </ul>
      <p class="small muted">Privacidad: el an√°lisis de audio y rostro ocurre en tu dispositivo. La medici√≥n de signos vitales requiere enviar un video corto a un servidor externo para su an√°lisis.</p>
      <div class="stack-sm"><button id="btnAboutBack" class="btn btn-secondary">Cerrar Sesi√≥n</button><button id="btnAboutStart" class="btn">Comenzar mediciones</button></div>
    </div>
  </div>

  <!-- ====================== SELFIE / ROSTRO ====================== -->
  <div id="screenFace" class="screen">
    <h2>Paso 1: Medici√≥n Facial</h2>
    <p class="muted">Detectaremos tu emoci√≥n dominante y, si lo deseas, tus signos vitales.</p>
    <div class="card max-900 two-cols">
      <div>
        <video id="faceVideo" playsinline muted class="video"></video>
        <canvas id="faceCanvas" class="video" style="display:none"></canvas>
        <div class="stack-sm"><button id="btnFaceStart" class="btn">üì∏ Activar c√°mara</button><button id="btnFaceSnap" class="btn btn-outline" disabled>Tomar selfie emocional</button><button id="btnVitalsStart" class="btn btn-outline" disabled>ü©∫ Medir Signos Vitales (20s)</button></div>
        <p id="faceHelp" class="muted small">Si no aparece el video, revisa permisos de c√°mara o abre en HTTPS / localhost.</p>
      </div>
      <div>
        <h3>Resultado Emocional</h3>
        <p><b>Emoci√≥n dominante:</b> <span id="faceEmotion">‚Äî</span></p><p><b>Confianza:</b> <span id="faceConfidence">‚Äî</span></p>
        <img id="faceMascot" class="mascot" alt="" /><p id="faceTip" class="muted"></p>
        <div class="stack-sm"><button id="btnFaceNext" class="btn" disabled>Siguiente Paso</button><button id="btnFaceSkip" class="btn btn-secondary">Saltar</button></div>
      </div>
    </div>
  </div>

  <!-- ====================== PANTALLA DE SIGNOS VITALES ====================== -->
  <div id="screenVitals" class="screen">
    <h2>Medici√≥n de Signos Vitales</h2>
    <p class="lead">Por favor, mant√©n tu rostro quieto y bien iluminado frente a la c√°mara.</p>
    <div class="card max-700">
        <video id="vitalsVideo" playsinline muted class="video"></video>
        <h3 id="vitalsStatus">Iniciando...</h3>
        <p id="vitalsCountdown" class="lead" style="font-size: 2rem; font-weight: bold;"></p>
        <div class="results-grid">
            <div><h4>Frecuencia Card√≠aca</h4><p><span id="hrValue" style="font-size: 1.5rem;">--</span> bpm</p></div>
            <div><h4>Frecuencia Respiratoria</h4><p><span id="rrValue" style="font-size: 1.5rem;">--</span> rpm</p></div>
        </div>
        <p class="muted small">Esta medici√≥n es una estimaci√≥n y no debe usarse para diagn√≥stico m√©dico.</p>
        <button id="btnVitalsDone" class="btn" disabled>Volver</button>
    </div>
  </div>
  
  <!-- ====================== INTRO MIC ====================== -->
  <div id="screenMicIntro" class="screen">
    <img src="images/mockup.png" alt="Mockup" class="mockup" />
    <h2>Paso 2: Medici√≥n Ambiental</h2>
    <p>Tomaremos una muestra de <b>5 segundos</b> para estimar dB(A)* y darte recomendaciones.</p>
    <p class="muted small">*Aproximaci√≥n desde dBFS del navegador con calibraci√≥n (¬±10 dB).</p>
    <button id="btnMicGo" class="btn">Ir a medir</button>
  </div>
  
  <div id="screenMeasure" class="screen">
    <h2>Medici√≥n en progreso</h2>
    <div class="gauge-wrapper"><canvas id="gaugeCanvas" width="280" height="280"></canvas><div class="gauge-center"><span id="dbValue" class="db-value">0</span><span class="db-unit">dB</span><div id="dbLabel" class="db-label">Silencioso</div><div id="countdown" class="countdown">5.0 s</div></div></div>
    <p id="status">Listo para empezar.</p>
    <div class="control-row"><label>Calibraci√≥n: <span id="calVal">0</span>dB</label><input type="range" id="calibration" min="-10" max="10" value="0" /></div>
    <div class="control-row"><label>Suavizado:</label><select id="smoothing"><option value="0">0</option><option value="0.5">0.5</option><option value="0.8" selected>0.8</option><option value="0.9">0.9</option></select></div>
    <div class="stack-sm"><button id="toggleBtn" class="btn">üéôÔ∏è Iniciar 5s</button><button id="btnMeasureToResults" class="btn btn-secondary" disabled>Ver resultados</button></div>
    <div class="tips-card card max-700"><h3>Mientras medimos‚Ä¶</h3><p id="motivation">Respira 4 segundos por la nariz y suelta 6 por la boca. Tu foco te lo agradece ‚ú®</p></div>
  </div>
  <div id="screenResults" class="screen">
    <div class="segmented"><button class="segment active">Ruido ambiental</button><button class="segment" onclick="show('#screenScanIntro')">Escaneo corporal</button></div>
    <h2>Resultados de tus mediciones</h2><p id="resultsSummary" class="lead">Aqu√≠ aparecer√° el resumen de tu estado.</p><canvas id="historyChart" height="160"></canvas>
    <h3>Tu indicador actual</h3><div id="currentIndicator" class="indicator-card"></div><h3>Tabla de referencia de dB(A) en oficina</h3><div id="allIndicators" class="carousel"></div>
    <div class="stack-sm"><button id="btnRetry" class="btn">Medir otra vez</button><button id="btnGoToBodyScan" class="btn btn-outline">Ir a Escaneo Corporal</button></div>
  </div>
  <div id="screenIndicatorDetail" class="screen"><button id="btnBackResults" class="btn btn-secondary">‚¨Ö Volver</button><div id="indicatorDetail" class="indicator-detail"></div></div>
  <div id="screenScanIntro" class="screen"><div class="card max-700"><div class="checkmark">‚úì</div><h2>Paso 3: Escaneo Corporal</h2><p>Ahora registraremos c√≥mo se siente tu cuerpo. Tres √°reas, escala 1‚Äì10 y algunos s√≠ntomas.</p><p class="muted">Tu privacidad es prioridad. Los datos se usan para mejorar tu bienestar.</p><div class="stack-sm"><button id="btnScanStart" class="btn">Comenzar</button><button id="btnScanIntroBack" class="btn btn-secondary">Volver</button></div></div></div>
  <div id="screenSurvey" class="screen">
    <h2>Encuesta breve de contexto</h2>
    <form id="workSurvey" class="form max-700">
      <div class="form-row two"><div><label>Fecha y hora</label><input type="datetime-local" id="ws_datetime" required /></div><div><label>√Årea / Puesto</label><select id="ws_area" required><option>Ventas</option><option>Administraci√≥n</option><option>Finanzas</option><option>TI</option><option>Marketing</option></select></div></div>
      <div class="form-row"><label>Horas trabajadas</label><input type="number" id="ws_hours" min="0" max="24" placeholder="Ej: 6" required /></div>
      <div class="slider-group"><label>Carga de trabajo hoy</label><input type="range" min="1" max="10" value="5" id="ws_carga" /><div class="range-ticks"><span>1</span><span>10</span></div></div>
      <div class="slider-group"><label>Ritmo de trabajo</label><input type="range" min="1" max="10" value="5" id="ws_ritmo" /><div class="range-ticks"><span>1</span><span>10</span></div></div>
      <div class="slider-group"><label>Estr√©s general</label><input type="range" min="1" max="10" value="5" id="ws_estres" /><div class="range-ticks"><span>1</span><span>10</span></div></div>
      <div class="stack-sm"><button type="button" id="btnToBodyScan" class="btn">Continuar</button><button type="button" id="btnSurveyBack" class="btn btn-secondary">Volver</button></div>
    </form>
  </div>
  <div id="screenBodyScan" class="screen">
    <h2>Body Scan (3 zonas)</h2><p class="muted">(1 = relajado, 10 = m√°xima tensi√≥n)</p>
    <div class="card max-900"><h3>1) Cabeza</h3><div class="slider-group"><label>Tensi√≥n en frente/ojos/mand√≠bula</label><input type="range" id="bs_head_tension" min="1" max="10" value="5"><div class="range-ticks"><span>1</span><span>10</span></div></div><div class="checks"><label><input type="checkbox" class="symptomHead" value="Dolor de cabeza"> Dolor de cabeza</label><label><input type="checkbox" class="symptomHead" value="Mand√≠bula apretada"> Mand√≠bula apretada</label><label><input type="checkbox" class="symptomHead" value="Visi√≥n cansada"> Visi√≥n cansada</label></div></div>
    <div class="card max-900"><h3>2) Tren superior</h3><div class="slider-group"><label>Cuello, hombros, espalda alta y pecho</label><input type="range" id="bs_upper_tension" min="1" max="10" value="5"><div class="range-ticks"><span>1</span><span>10</span></div></div><div class="checks"><label><input type="checkbox" class="symptomUpper" value="Hombros r√≠gidos"> Hombros r√≠gidos</label><label><input type="checkbox" class="symptomUpper" value="Respiraci√≥n corta"> Respiraci√≥n corta</label><label><input type="checkbox" class="symptomUpper" value="Dolor espalda alta"> Dolor espalda alta</label></div></div>
    <div class="card max-900"><h3>3) Tren inferior</h3><div class="slider-group"><label>Lumbar, caderas, piernas</label><input type="range" id="bs_lower_tension" min="1" max="10" value="5"><div class="range-ticks"><span>1</span><span>10</span></div></div><div class="checks"><label><input type="checkbox" class="symptomLower" value="Dolor lumbar"> Dolor lumbar</label><label><input type="checkbox" class="symptomLower" value="Piernas pesadas"> Piernas pesadas</label><label><input type="checkbox" class="symptomLower" value="Tensi√≥n caderas"> Tensi√≥n caderas</label></div></div>
    <div class="card max-700"><div class="slider-group"><label><b>Nivel total</b> de tensi√≥n f√≠sica ahora</label><input type="range" min="1" max="10" value="5" id="bs_total" /><div class="range-ticks"><span>1</span><span>10</span></div></div><div class="slider-group"><label><b>Cansancio f√≠sico general</b></label><input type="range" min="1" max="10" value="5" id="bs_fatiga" /><div class="range-ticks"><span>1</span><span>10</span></div></div></div>
    <div class="stack-sm"><button id="btnBodyScanFinish" class="btn">Ver resultados</button><button id="btnBodyScanBack" class="btn btn-secondary">Volver</button></div>
  </div>
  <div id="screenScanResults" class="screen">
    <h2>Resumen ‚Äî Escaneo corporal</h2>
    <div class="results-grid max-900"><div class="card"><h3>Puntajes</h3><p><b>Cabeza:</b> <span id="bs_head_out">‚Äî</span>/10</p><p><b>Tren superior:</b> <span id="bs_upper_out">‚Äî</span>/10</p><p><b>Tren inferior:</b> <span id="bs_lower_out">‚Äî</span>/10</p><p><b>Tensi√≥n media:</b> <span id="bs_avg">‚Äî</span>/10</p><p><b>Total:</b> <span id="bs_total_display">‚Äî</span>/10 ¬∑ <b>Fatiga:</b> <span id="bs_fatiga_display">‚Äî</span>/10</p><p><b>S√≠ntomas:</b> <span id="bs_symptoms_display">Ninguno</span></p></div><div class="card"><h3>Distribuci√≥n</h3><canvas id="bsChart"></canvas></div></div>
    <div class="stack-sm"><button id="btnToIntegration" class="btn">Ver Informe Final</button><button id="btnScanResultsBack" class="btn btn-secondary">Volver</button></div>
  </div>
  <div id="screenIntegration" class="screen">
    <h2>Informe de Bienestar</h2>
    <p class="muted">Integramos <b>Selfie emocional</b> + <b>Signos Vitales</b> + <b>dB(A)</b> + <b>Body Scan</b>.</p>
    <div class="card max-900">
      <div class="two-cols">
        <div><h3>Selfie</h3><p><b>Emoci√≥n:</b> <span id="ix_face_emotion">‚Äî</span></p><p><b>Puntaje (0‚Äì100):</b> <span id="ix_face_score">‚Äî</span></p></div>
        <div><h3>Signos Vitales</h3><p><b>Ritmo Card√≠aco:</b> <span id="ix_hr">‚Äî</span> bpm</p><p><b>Ritmo Respiratorio:</b> <span id="ix_rr">‚Äî</span> rpm</p></div>
      </div>
      <div class="two-cols">
        <div><h3>Ruido</h3><p><b>Promedio:</b> <span id="ix_db">‚Äî</span> dB</p><p><b>Clasificaci√≥n:</b> <span id="ix_db_class">‚Äî</span></p></div>
        <div><h3>Escaneo corporal</h3><p><b>Tensi√≥n media:</b> <span id="ix_bs_avg">‚Äî</span>/10</p><p><b>Total:</b> <span id="ix_bs_total">‚Äî</span>/10</p></div>
      </div>
      <hr style="border-color: rgba(255,255,255,0.1); margin: 1rem 0;">
      <div style="text-align: center;">
        <h3>Resultado</h3>
        <p><b>√çndice combinado (0‚Äì100)</b>: <span id="ix_score" style="font-weight: bold; font-size: 1.2em;">‚Äî</span></p>
        <p><b>Estado:</b> <span id="ix_label" style="font-weight: bold;">‚Äî</span></p>
        <img id="ix_mascot" class="mascot" alt=""><p id="ix_reco" class="muted"></p>
      </div>
    </div>
    <div class="stack-sm"><button id="btnIntegrationBack" class="btn btn-secondary">Volver</button><button id="btnIntegrationHome" class="btn btn-outline">Nueva Medici√≥n</button></div>
  </div>

  <script src="app.js"></script>

</body>
</html>


